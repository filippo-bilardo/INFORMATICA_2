### **7.14 Framework e librerie Canvas**

Benché la programmazione diretta con Canvas offra il massimo controllo, i framework e le librerie specializzate possono accelerare lo sviluppo e fornire funzionalità avanzate già pronte all'uso. In questo capitolo esploreremo le principali soluzioni disponibili.

---

### **Perché usare framework Canvas?**

1. **Sviluppo più rapido**  
   Le librerie forniscono componenti e funzioni predefinite che riducono il codice da scrivere.

2. **Gestione ottimizzata degli oggetti**  
   Molti framework implementano sistemi di rendering efficienti e gestione automatica delle collisioni.

3. **Funzionalità avanzate**  
   Animazioni complesse, fisica, sistemi di particelle e altre funzionalità specializzate.

4. **Compatibilità cross-browser**  
   I framework gestiscono le differenze tra browser, riducendo il codice necessario per la compatibilità.

---

### **Principali framework e librerie**

#### **1. Fabric.js**

Fabric.js è una potente libreria che fornisce un'astrazione orientata agli oggetti sopra la Canvas API.

**Caratteristiche principali:**
- Manipolazione di oggetti interattivi (selezione, ridimensionamento, rotazione)
- Serializzazione JSON degli oggetti
- Supporto per il caricamento di immagini SVG
- Animazioni e transizioni
- Gestione avanzata dei testi

**Esempio base con Fabric.js:**
```javascript
// Creare un canvas Fabric
const canvas = new fabric.Canvas('myCanvas');

// Aggiungere un rettangolo
const rect = new fabric.Rect({
    left: 100,
    top: 100,
    width: 100,
    height: 100,
    fill: 'red',
    angle: 15
});

// Aggiungere un testo
const text = new fabric.Text('Hello Fabric.js', {
    left: 150,
    top: 200,
    fontFamily: 'Arial',
    fontSize: 30,
    fill: 'blue'
});

// Aggiungi oggetti al canvas
canvas.add(rect);
canvas.add(text);

// Rendi gli oggetti selezionabili e modificabili
canvas.setActiveObject(text);
```

**Link:** [Fabric.js](http://fabricjs.com/)

---

#### **2. Paper.js**

Paper.js è un framework di grafica vettoriale che funziona con un modello di grafico a scene.

**Caratteristiche principali:**
- Modello a grafo della scena
- Linguaggio di scripting PaperScript
- Matematica vettoriale avanzata
- Sistema di animazione fluido
- Gestione intelligente dei percorsi

**Esempio base con Paper.js:**
```javascript
// Definisci una funzione PaperScript
paper.install(window);

window.onload = function() {
    // Setup del canvas
    paper.setup('myCanvas');
    
    // Crea un cerchio
    var circle = new Path.Circle({
        center: view.center,
        radius: 70,
        fillColor: 'red'
    });
    
    // Animazione
    view.onFrame = function(event) {
        circle.fillColor.hue += 1;
        circle.scale(Math.sin(event.count / 30) * 0.01 + 1);
    };
};
```

**Link:** [Paper.js](http://paperjs.org/)

---

#### **3. Pixi.js**

Pixi.js è una libreria di rendering 2D velocissima che sfrutta WebGL con fallback a Canvas.

**Caratteristiche principali:**
- Rendering WebGL ad alte prestazioni
- Sistema di sprite e container
- Filtri e blend modes
- Texture e texture atlas
- Ottimizzato per i giochi e applicazioni interattive

**Esempio base con Pixi.js:**
```javascript
// Crea l'applicazione
const app = new PIXI.Application({
    width: 800,
    height: 600,
    backgroundColor: 0x1099bb
});
document.body.appendChild(app.view);

// Carica una texture
const texture = PIXI.Texture.from('bunny.png');

// Crea uno sprite
const bunny = new PIXI.Sprite(texture);
bunny.anchor.set(0.5);
bunny.x = app.screen.width / 2;
bunny.y = app.screen.height / 2;

// Aggiungi lo sprite allo stage
app.stage.addChild(bunny);

// Animazione
app.ticker.add(() => {
    bunny.rotation += 0.01;
});
```

**Link:** [Pixi.js](https://pixijs.com/)

---

#### **4. Three.js**

Benché sia primariamente una libreria 3D, Three.js può essere usato anche per grafica 2D avanzata.

**Caratteristiche principali:**
- Integrazione 2D e 3D
- Renderer WebGL, CSS3D, e SVG
- Sistema di camera flessibile
- Animazione e morphing
- Supporto per modelli 3D

**Esempio per 2D con Three.js:**
```javascript
// Configurazione della scena
const scene = new THREE.Scene();
const camera = new THREE.OrthographicCamera(
    window.innerWidth / -2,
    window.innerWidth / 2,
    window.innerHeight / 2,
    window.innerHeight / -2,
    1, 1000
);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Crea una forma 2D
const geometry = new THREE.PlaneGeometry(200, 200);
const material = new THREE.MeshBasicMaterial({
    color: 0xff0000,
    side: THREE.DoubleSide
});
const plane = new THREE.Mesh(geometry, material);
scene.add(plane);

// Rendering e animazione
function animate() {
    requestAnimationFrame(animate);
    plane.rotation.z += 0.01;
    renderer.render(scene, camera);
}
animate();
```

**Link:** [Three.js](https://threejs.org/)

---

#### **5. Konva.js**

Konva è un framework Canvas 2D che fornisce un'alta performance per applicazioni desktop e mobile.

**Caratteristiche principali:**
- API orientata agli oggetti
- Animazioni e transizioni 
- Sistema di eventi robusto
- Ottima gestione della memoria
- Supporto per dispositivi mobili

**Esempio base con Konva:**
```javascript
// Configura lo stage e il layer
const stage = new Konva.Stage({
    container: 'container',
    width: 500,
    height: 500
});

const layer = new Konva.Layer();
stage.add(layer);

// Crea una stella
const star = new Konva.Star({
    x: stage.width() / 2,
    y: stage.height() / 2,
    numPoints: 5,
    innerRadius: 40,
    outerRadius: 70,
    fill: 'yellow',
    stroke: 'black',
    strokeWidth: 4,
    draggable: true
});

// Aggiungi la stella al layer
layer.add(star);
layer.draw();

// Gestione evento click
star.on('click', function() {
    this.fill(Konva.Util.getRandomColor());
    layer.draw();
});
```

**Link:** [Konva.js](https://konvajs.org/)

---

### **Confronto: Vanilla Canvas vs Framework**

#### **Vantaggi del Canvas nativo**
- **Controllo completo**: Accesso diretto all'API Canvas senza astrazione.
- **Dimensioni minime**: Nessuna dipendenza esterna.
- **Apprendimento più profondo**: Comprensione completa della tecnologia sottostante.

#### **Vantaggi dei framework**
- **Produttività**: Sviluppo più veloce per progetti complessi.
- **Manutenibilità**: Codice meglio organizzato e più leggibile.
- **Funzionalità avanzate**: Accesso immediato a funzionalità che richiederebbero molto codice personalizzato.
- **Prestazioni ottimizzate**: Molte librerie sono ottimizzate per casi d'uso specifici.

---

### **Scegliere il framework giusto**

La scelta del framework dovrebbe basarsi sulle esigenze specifiche del progetto:

1. **Fabric.js**: Ideale per editor grafici e applicazioni con interazione diretta con gli oggetti.
2. **Paper.js**: Ottimo per grafiche vettoriali artistiche e animazioni fluide.
3. **Pixi.js**: Perfetto per giochi ad alte prestazioni e applicazioni con molti sprite.
4. **Three.js**: La scelta migliore quando si necessita di combinare elementi 2D e 3D.
5. **Konva.js**: Ideale per applicazioni interattive complesse con supporto mobile.

---

### **Esempio pratico: Mini-editor con Fabric.js**

```html
<!DOCTYPE html>
<html>
<head>
    <title>Mini Editor con Fabric.js</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
    <style>
        #controls {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="controls">
        <button id="addRect">+ Rettangolo</button>
        <button id="addCircle">+ Cerchio</button>
        <button id="addText">+ Testo</button>
        <button id="delete">Elimina</button>
        <input type="color" id="colorPicker" value="#ff0000">
    </div>
    <canvas id="canvas" width="800" height="600" style="border:1px solid #ccc"></canvas>
    
    <script>
        // Inizializza Canvas
        const canvas = new fabric.Canvas('canvas');
        
        // Aggiungi un rettangolo
        document.getElementById('addRect').addEventListener('click', function() {
            const rect = new fabric.Rect({
                left: 100,
                top: 100,
                width: 100,
                height: 100,
                fill: document.getElementById('colorPicker').value,
                cornerStyle: 'circle',
                transparentCorners: false
            });
            canvas.add(rect);
            canvas.setActiveObject(rect);
        });
        
        // Aggiungi un cerchio
        document.getElementById('addCircle').addEventListener('click', function() {
            const circle = new fabric.Circle({
                left: 200,
                top: 200,
                radius: 50,
                fill: document.getElementById('colorPicker').value,
                cornerStyle: 'circle',
                transparentCorners: false
            });
            canvas.add(circle);
            canvas.setActiveObject(circle);
        });
        
        // Aggiungi testo
        document.getElementById('addText').addEventListener('click', function() {
            const text = new fabric.Textbox('Doppio click per modificare', {
                left: 150,
                top: 300,
                width: 200,
                fill: document.getElementById('colorPicker').value,
                fontSize: 20,
                fontFamily: 'Arial'
            });
            canvas.add(text);
            canvas.setActiveObject(text);
        });
        
        // Elimina oggetto selezionato
        document.getElementById('delete').addEventListener('click', function() {
            const activeObject = canvas.getActiveObject();
            if (activeObject) {
                canvas.remove(activeObject);
            }
        });
        
        // Cambia colore dell'oggetto selezionato
        document.getElementById('colorPicker').addEventListener('input', function() {
            const activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.set('fill', this.value);
                canvas.renderAll();
            }
        });
    </script>
</body>
</html>
```

---

### **Conclusioni**

I framework Canvas accelerano significativamente lo sviluppo di applicazioni grafiche complesse, ma è importante comprendere anche i principi fondamentali di Canvas nativo. Una buona strategia è iniziare con Canvas nativo per progetti semplici e passare a un framework adeguato quando il progetto richiede funzionalità più avanzate o un'architettura più robusta.

---
[Ottimizzazione delle prestazioni](<07.13 Ottimizzazione delle prestazioni.md>) | [Indice](<README.md>)
